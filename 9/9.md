# 9. Metodolog√≠a de Dise√±o de Arquitectura - Aplicaci√≥n de ADD

## 9.1. Revisi√≥n de Entradas

Para dar inicio al proceso de validaci√≥n arquitect√≥nica de Shopcart bajo la metodolog√≠a ADD (Attribute-Driven Design), se tomaron como entradas clave:

- Los **requisitos funcionales** distribuidos en 12 m√≥dulos innovadores.
- Los **atributos de calidad** priorizados por el equipo: interactividad emocional, escalabilidad, mantenibilidad, accesibilidad y seguridad.
- Las **restricciones** tecnol√≥gicas y organizativas, incluyendo el uso de React, Node.js, microservicios, y cumplimiento legal de protecci√≥n de datos.
- La **visi√≥n del sistema**, centrada en transformar una experiencia de compra tradicional en una vivencia emocional, colaborativa y personalizada.

Estas entradas permitieron definir escenarios arquitect√≥nicos claros y tomar decisiones fundamentadas en las siguientes iteraciones.

---

## 9.2. Iteraci√≥n 1: Definir la estructura general del sistema

En esta primera iteraci√≥n se dise√±√≥ la **arquitectura de alto nivel**, abordando los escenarios funcionales primarios.

Decisiones tomadas:

- Adopci√≥n de una **arquitectura de microservicios**, dividiendo funcionalidades clave como usuarios, emociones, recomendaciones, pagos y carrito.
- Separaci√≥n clara entre **frontend (React)** y **backend (Node.js + Express)**.
- Comunicaci√≥n entre servicios mediante **API REST** y preparaci√≥n para eventos pub/sub futuros.
- Definici√≥n de la **estructura modular**, donde cada microservicio se dise√±a, prueba y despliega por separado.

Este dise√±o inicial permite una base escalable, flexible y adaptable a futuras extensiones de Shopcart.

---

## 9.3. Iteraci√≥n 2: Identificar estructuras para soportar la funcionalidad primaria

En esta iteraci√≥n se profundiz√≥ en las **estructuras necesarias para implementar funcionalidades esenciales** como:

- Registro emocional, login social y autenticaci√≥n segura (JWT + IdP).
- B√∫squeda emocional e inteligente con filtros por estilo de vida.
- Carrito de compras y carrito colaborativo en tiempo real.
- Proceso de pago multicanal (tarjetas, PayPal, cripto).

Se realizaron pruebas de integraci√≥n entre microservicios y validaciones funcionales, garantizando que el sistema soporte los flujos de usuario m√°s cr√≠ticos.

---

## 9.4. Iteraci√≥n 3: Refinar estructuras para abordar el atributo de calidad m√°s importante

El atributo m√°s cr√≠tico identificado fue la **experiencia emocional personalizada del usuario**. Las decisiones arquitect√≥nicas se ajustaron para maximizar este atributo:

- Implementaci√≥n de interfaces adaptativas que cambian visual y funcionalmente seg√∫n el estado emocional.
- Motor de recomendaciones personalizado basado en emociones y roles.
- Respuestas r√°pidas y sincronizadas entre m√≥dulos (p. ej., StoryCart + Recompensas).
- Priorizaci√≥n del rendimiento y bajo tiempo de respuesta para mantener una experiencia envolvente y sin fricciones.

Estas acciones mejoraron directamente el engagement del usuario y su fidelizaci√≥n.

---

## 9.5. Iteraciones adicionales: Otros atributos de calidad

Se continu√≥ refinando la arquitectura para abordar otros atributos importantes:

- **Escalabilidad**: Se configuraron servicios contenedorizados (Docker) con capacidad de replicaci√≥n.
- **Seguridad**: Se incorporaron tokens seguros (JWT), cifrado en tr√°nsito, e integraci√≥n con IdP externos (Firebase/Auth0).
- **Mantenibilidad**: Se aplic√≥ una estructura de c√≥digo limpia, reutilizable y bien documentada.
- **Disponibilidad**: Se definieron puntos de monitoreo y recuperaci√≥n ante errores, especialmente en servicios cr√≠ticos como pagos y autenticaci√≥n.

Estas iteraciones consolidaron una arquitectura robusta, preparada para el crecimiento sostenido de Shopcart en producci√≥n.


## 9.6. Iteraci√≥n 6: Validaci√≥n del despliegue e integraci√≥n de servicios

Durante esta iteraci√≥n se ejecut√≥ el sistema completo Shopcart en entorno local para validar la correcta integraci√≥n, automatizaci√≥n y despliegue de todos los componentes de la arquitectura definida en las iteraciones anteriores.

El proceso automatizado se dividi√≥ en etapas claramente estructuradas mediante un script de PowerShell (`INICIAR_TODO.ps1`), el cual se ejecuta **con privilegios de administrador**.

### üîß Flujo de ejecuci√≥n automatizada

1. **Verificaci√≥n de servicios base:**
   - Se valida e instala autom√°ticamente Node.js, PostgreSQL y RabbitMQ si no est√°n disponibles.
   - Se asegura que PostgreSQL est√© activo en el puerto 5432 y RabbitMQ en el puerto 5672.

2. **Inicializaci√≥n de base de datos:**
   - Se ejecutan scripts SQL para preparar la base de datos `shopcart_db`.
   - A pesar de un mensaje de advertencia sint√°ctico, la creaci√≥n de tablas y usuarios se realiza correctamente.

3. **Instalaci√≥n y configuraci√≥n de pgAdmin4:**
   - Se instala (o verifica instalaci√≥n existente) de la herramienta pgAdmin para la gesti√≥n visual de la base de datos.

4. **Verificaci√≥n de dependencias:**
   - Se comprueba que todos los microservicios tengan sus m√≥dulos instalados correctamente (`node_modules`).
   - Incluye: `api-gateway`, `user-service`, `product-service`, `cart-service`, `payment-service`, `category-service`.

5. **Ejecuci√≥n de microservicios:**
   - Cada microservicio se inicia en su propio terminal, con puertos dedicados:

     | Servicio         | Puerto |
     |------------------|--------|
     | API Gateway      | 5000   |
     | User Service     | 5001   |
     | Product Service  | 5002   |
     | Cart Service     | 5003   |
     | Category Service | 5004   |
     | Payment Service  | 5005   |

   - Se realiza verificaci√≥n mediante `curl`/fetch de los endpoints `/health` para asegurar que cada servicio est√© activo y saludable.

6. **Inicio del Frontend:**
   - El frontend (Next.js) se inicia en un terminal aparte y corre en `http://localhost:3000`.

7. **Resumen general del sistema:**
   - Se muestran los servicios activos, los puertos en uso, y los datos cargados en la base de datos, incluyendo:
     - Usuarios de ejemplo (admin, cliente, vendedor)
     - Productos precargados
     - Carritos preconfigurados
     - Configuraci√≥n de Google OAuth2

8. **Verificaci√≥n de archivos `.env`:**
   - Se validan variables de entorno necesarias para Google OAuth (`GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`) y autenticaci√≥n JWT.

### ‚úÖ Resultado

Esta iteraci√≥n permiti√≥ validar la arquitectura implementada bajo condiciones reales de ejecuci√≥n, asegurando:

- El correcto funcionamiento de todos los microservicios y su comunicaci√≥n.
- La preparaci√≥n de la base de datos y herramientas administrativas.
- La experiencia completa de ejecuci√≥n local lista para pruebas funcionales y de rendimiento.
- La usabilidad del entorno por otros desarrolladores del equipo sin necesidad de configuraciones manuales.

```md
URL principal: [http://localhost:3000](http://localhost:3000)  
Autenticaci√≥n Google: [http://localhost:5001/api/users/auth/google](http://localhost:5001/api/users/auth/google)
